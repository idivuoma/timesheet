<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Submission System</title>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        .date-input { position: relative; }
        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [currentPage, setCurrentPage] = useState(0);
            const [employeeInfo, setEmployeeInfo] = useState({
                firstName: '',
                lastName: '',
                address: '',
                country: '',
                bankAccount: '',
                ssn: '',
                email: '',
                project: '',
                workStart: '',
                workEnd: ''
            });

            const [timesheet, setTimesheet] = useState({
                monday: { start: '', end: '', lunch: '', notes: '' },
                tuesday: { start: '', end: '', lunch: '', notes: '' },
                wednesday: { start: '', end: '', lunch: '', notes: '' },
                thursday: { start: '', end: '', lunch: '', notes: '' },
                friday: { start: '', end: '', lunch: '', notes: '' },
                saturday: { start: '', end: '', lunch: '', notes: '' },
                sunday: { start: '', end: '', lunch: '', notes: '' },
                foodReimbursement: false
            });

            const [travel, setTravel] = useState([]);
            const [expenses, setExpenses] = useState([]);
            const [signature, setSignature] = useState('');

            // Load saved progress
            useEffect(() => {
                const saved = localStorage.getItem('employeeSubmission');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        if (data.employeeInfo) setEmployeeInfo(data.employeeInfo);
                        if (data.timesheet) setTimesheet(data.timesheet);
                        if (data.travel) setTravel(data.travel);
                        if (data.expenses) setExpenses(data.expenses);
                    } catch (e) {
                        console.error('Error loading saved data:', e);
                    }
                }
            }, []);

            // Save progress
            const saveProgress = () => {
                const data = { employeeInfo, timesheet, travel, expenses };
                localStorage.setItem('employeeSubmission', JSON.stringify(data));
                alert('Progress saved successfully!');
            };

            // Export data
            const exportData = () => {
                const data = { employeeInfo, timesheet, travel, expenses, signature };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `submission_${employeeInfo.firstName}_${employeeInfo.lastName}_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            // Import data
            const importData = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.employeeInfo) setEmployeeInfo(data.employeeInfo);
                            if (data.timesheet) setTimesheet(data.timesheet);
                            if (data.travel) setTravel(data.travel);
                            if (data.expenses) setExpenses(data.expenses);
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data. Please check the file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            const calculateHours = (start, end, lunch) => {
                if (!start || !end) return 0;
                const [startH, startM] = start.split(':').map(Number);
                const [endH, endM] = end.split(':').map(Number);
                let hours = (endH * 60 + endM - startH * 60 - startM) / 60;
                if (lunch) hours -= parseFloat(lunch);
                return Math.max(0, hours);
            };

            const getTotalHours = () => {
                return Object.keys(timesheet).reduce((total, day) => {
                    if (day !== 'foodReimbursement' && timesheet[day].start && timesheet[day].end) {
                        return total + calculateHours(timesheet[day].start, timesheet[day].end, timesheet[day].lunch);
                    }
                    return total;
                }, 0);
            };

            const getOvertime = () => {
                const total = getTotalHours();
                return Math.max(0, total - 37.5);
            };

            const getTravelReimbursement = () => {
                return travel.reduce((sum, trip) => sum + (parseFloat(trip.km) || 0) * 4.5, 0);
            };

            const getExpensesTotal = () => {
                return expenses.reduce((sum, exp) => sum + (parseFloat(exp.amount) || 0), 0);
            };

            const generatePDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let yPos = 20;

                doc.setFontSize(18);
                doc.text('Employee Submission Report', 105, yPos, { align: 'center' });
                yPos += 15;

                doc.setFontSize(12);
                doc.text('Employee Information', 20, yPos);
                yPos += 8;
                doc.setFontSize(10);
                doc.text(`Name: ${employeeInfo.firstName} ${employeeInfo.lastName}`, 20, yPos);
                yPos += 6;
                doc.text(`Address: ${employeeInfo.address}`, 20, yPos);
                yPos += 6;
                doc.text(`Country: ${employeeInfo.country}`, 20, yPos);
                yPos += 6;
                doc.text(`Bank Account: ${employeeInfo.bankAccount}`, 20, yPos);
                yPos += 6;
                doc.text(`SSN: ${employeeInfo.ssn}`, 20, yPos);
                yPos += 6;
                doc.text(`Email: ${employeeInfo.email}`, 20, yPos);
                yPos += 6;
                doc.text(`Project: ${employeeInfo.project}`, 20, yPos);
                yPos += 6;
                doc.text(`Work Period: ${employeeInfo.workStart} to ${employeeInfo.workEnd}`, 20, yPos);
                yPos += 12;

                doc.setFontSize(12);
                doc.text('Timesheet', 20, yPos);
                yPos += 8;
                doc.setFontSize(10);

                ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
                    if (timesheet[day].start && timesheet[day].end) {
                        const hours = calculateHours(timesheet[day].start, timesheet[day].end, timesheet[day].lunch);
                        doc.text(`${day.charAt(0).toUpperCase() + day.slice(1)}: ${timesheet[day].start} - ${timesheet[day].end} (${hours.toFixed(2)}h)`, 20, yPos);
                        yPos += 6;
                        if (timesheet[day].lunch) {
                            doc.text(`  Lunch: ${timesheet[day].lunch}h`, 20, yPos);
                            yPos += 6;
                        }
                        if (timesheet[day].notes) {
                            doc.text(`  Notes: ${timesheet[day].notes}`, 20, yPos);
                            yPos += 6;
                        }
                    }
                });

                doc.text(`Total Hours: ${getTotalHours().toFixed(2)}h`, 20, yPos);
                yPos += 6;
                doc.text(`Overtime: ${getOvertime().toFixed(2)}h`, 20, yPos);
                yPos += 6;
                if (timesheet.foodReimbursement) {
                    doc.text(`Food Reimbursement: 678 NOK`, 20, yPos);
                    yPos += 6;
                }
                yPos += 8;

                if (travel.length > 0) {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    doc.setFontSize(12);
                    doc.text('Travel Expenses', 20, yPos);
                    yPos += 8;
                    doc.setFontSize(10);
                    travel.forEach((trip, idx) => {
                        doc.text(`${idx + 1}. ${trip.date}: ${trip.from} → ${trip.to} (${trip.km} km) - ${(trip.km * 4.5).toFixed(2)} NOK`, 20, yPos);
                        yPos += 6;
                        if (yPos > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                    });
                    doc.text(`Total Travel: ${getTravelReimbursement().toFixed(2)} NOK`, 20, yPos);
                    yPos += 10;
                }

                if (expenses.length > 0) {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    doc.setFontSize(12);
                    doc.text('Other Expenses', 20, yPos);
                    yPos += 8;
                    doc.setFontSize(10);
                    expenses.forEach((exp, idx) => {
                        doc.text(`${idx + 1}. ${exp.date} - ${exp.type}: ${exp.description} - ${exp.amount} NOK`, 20, yPos);
                        yPos += 6;
                        if (yPos > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                    });
                    doc.text(`Total Expenses: ${getExpensesTotal().toFixed(2)} NOK`, 20, yPos);
                    yPos += 10;
                }

                if (yPos > 260) {
                    doc.addPage();
                    yPos = 20;
                }
                doc.setFontSize(12);
                doc.text('Signature', 20, yPos);
                yPos += 8;
                doc.setFontSize(10);
                doc.text(`Signed by: ${signature}`, 20, yPos);
                yPos += 6;
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, yPos);

                doc.save(`submission_${employeeInfo.firstName}_${employeeInfo.lastName}.pdf`);
            };

            const emailSummary = () => {
                const subject = `Employee Submission - ${employeeInfo.firstName} ${employeeInfo.lastName}`;
                const body = `Employee Submission Summary\n\nName: ${employeeInfo.firstName} ${employeeInfo.lastName}\nTotal Hours: ${getTotalHours().toFixed(2)}h\nOvertime: ${getOvertime().toFixed(2)}h\nTravel Reimbursement: ${getTravelReimbursement().toFixed(2)} NOK\nExpenses: ${getExpensesTotal().toFixed(2)} NOK`;
                window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            };

            const pages = [
                <EmployeeInfoPage 
                    info={employeeInfo} 
                    setInfo={setEmployeeInfo} 
                    onNext={() => setCurrentPage(1)} 
                />,
                <TimesheetPage 
                    timesheet={timesheet} 
                    setTimesheet={setTimesheet} 
                    onNext={() => setCurrentPage(2)} 
                    onPrev={() => setCurrentPage(0)}
                />,
                <TravelPage 
                    travel={travel} 
                    setTravel={setTravel} 
                    onNext={() => setCurrentPage(3)} 
                    onPrev={() => setCurrentPage(1)}
                    onSkip={() => setCurrentPage(3)}
                />,
                <ExpensesPage 
                    expenses={expenses} 
                    setExpenses={setExpenses} 
                    onNext={() => setCurrentPage(4)} 
                    onPrev={() => setCurrentPage(2)}
                    onSkip={() => setCurrentPage(4)}
                />,
                <SignaturePage 
                    signature={signature} 
                    setSignature={setSignature} 
                    onPrev={() => setCurrentPage(3)}
                    onSubmit={generatePDF}
                    onEmail={emailSummary}
                    employeeInfo={employeeInfo}
                    totalHours={getTotalHours()}
                    overtime={getOvertime()}
                    travelReimbursement={getTravelReimbursement()}
                    expensesTotal={getExpensesTotal()}
                    foodReimbursement={timesheet.foodReimbursement}
                />
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    <div className="container mx-auto px-4 py-8 max-w-4xl">
                        <div className="bg-white rounded-lg shadow-xl p-6 md:p-8">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-3xl font-bold text-indigo-900">Employee Submission System</h1>
                                <div className="flex gap-2">
                                    <button onClick={saveProgress} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 text-sm">
                                        <i className="fas fa-save mr-2"></i>Save
                                    </button>
                                    <button onClick={exportData} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                        <i className="fas fa-download mr-2"></i>Export
                                    </button>
                                    <label className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 cursor-pointer text-sm">
                                        <i className="fas fa-upload mr-2"></i>Import
                                        <input type="file" accept=".json" onChange={importData} className="hidden" />
                                    </label>
                                </div>
                            </div>
                            
                            <div className="mb-6">
                                <div className="flex justify-between items-center">
                                    {['Info', 'Timesheet', 'Travel', 'Expenses', 'Signature'].map((label, idx) => (
                                        <div key={idx} className="flex items-center">
                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center ${currentPage >= idx ? 'bg-indigo-600 text-white' : 'bg-gray-300 text-gray-600'}`}>
                                                {idx + 1}
                                            </div>
                                            <span className="ml-2 text-sm font-medium hidden md:inline">{label}</span>
                                            {idx < 4 && <div className={`w-12 h-1 mx-2 ${currentPage > idx ? 'bg-indigo-600' : 'bg-gray-300'}`}></div>}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {pages[currentPage]}
                        </div>
                    </div>
                </div>
            );
        }

        function EmployeeInfoPage({ info, setInfo, onNext }) {
            const handleSubmit = (e) => {
                e.preventDefault();
                onNext();
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <h2 className="text-2xl font-bold text-indigo-900 mb-4">Employee Information</h2>
                    
                    <div className="grid md:grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                            <input type="text" required value={info.firstName} onChange={(e) => setInfo({...info, firstName: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="John" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                            <input type="text" required value={info.lastName} onChange={(e) => setInfo({...info, lastName: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Doe" />
                        </div>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Full Address *</label>
                        <input type="text" required value={info.address} onChange={(e) => setInfo({...info, address: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Street, City, Postal Code" />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Country *</label>
                        <input type="text" required value={info.country} onChange={(e) => setInfo({...info, country: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Norway" />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Bank Account *</label>
                        <input type="text" required value={info.bankAccount} onChange={(e) => setInfo({...info, bankAccount: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="NO93 8601 1117 947" />
                        <p className="text-xs text-gray-500 mt-1">Enter your IBAN or local bank account number</p>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Social Security Number *</label>
                        <input type="text" required value={info.ssn} onChange={(e) => setInfo({...info, ssn: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="11 digits" />
                        <p className="text-xs text-gray-500 mt-1">11-digit Norwegian SSN (fødselsnummer)</p>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" required value={info.email} onChange={(e) => setInfo({...info, email: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="john.doe@example.com" />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Project *</label>
                        <select required value={info.project} onChange={(e) => setInfo({...info, project: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Select a project</option>
                            <option value="Haugalandet">Haugalandet</option>
                            <option value="Forus">Forus</option>
                            <option value="Mongstad">Mongstad</option>
                            <option value="Kårstø">Kårstø</option>
                            <option value="Kollsnes">Kollsnes</option>
                            <option value="Sture">Sture</option>
                        </select>
                    </div>

                    <div className="grid md:grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Work Start *</label>
                            <input type="date" required value={info.workStart} onChange={(e) => setInfo({...info, workStart: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                            <p className="text-xs text-gray-500 mt-1">First day of work period</p>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Work End *</label>
                            <input type="date" required value={info.workEnd} onChange={(e) => setInfo({...info, workEnd: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                            <p className="text-xs text-gray-500 mt-1">Last day of work period</p>
                        </div>
                    </div>

                    <button type="submit" className="w-full mt-6 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        Next: Timesheet <i className="fas fa-arrow-right ml-2"></i>
                    </button>
                </form>
            );
        }

        function TimesheetPage({ timesheet, setTimesheet, onNext, onPrev }) {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

            const handleSubmit = (e) => {
                e.preventDefault();
                onNext();
            };

            const calculateHours = (start, end, lunch) => {
                if (!start || !end) return 0;
                const [startH, startM] = start.split(':').map(Number);
                const [endH, endM] = end.split(':').map(Number);
                let hours = (endH * 60 + endM - startH * 60 - startM) / 60;
                if (lunch) hours -= parseFloat(lunch);
                return Math.max(0, hours);
            };

            const getTotalHours = () => {
                return days.reduce((total, day) => {
                    return total + calculateHours(timesheet[day].start, timesheet[day].end, timesheet[day].lunch);
                }, 0);
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <h2 className="text-2xl font-bold text-indigo-900 mb-4">Weekly Timesheet</h2>

                    {timesheet.foodReimbursement && (
                        <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <div className="flex">
                                <i className="fas fa-info-circle text-yellow-400 mt-1 mr-3"></i>
                                <div>
                                    <p className="text-sm text-yellow-700">
                                        <strong>Food Reimbursement Selected:</strong> You will receive 678 NOK for buying your own food during this work period.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {days.map(day => (
                        <div key={day} className="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <h3 className="font-semibold text-lg text-gray-800 mb-3 capitalize">{day}</h3>
                            <div className="grid md:grid-cols-4 gap-3">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                                    <input type="time" value={timesheet[day].start} onChange={(e) => setTimesheet({...timesheet, [day]: {...timesheet[day], start: e.target.value}})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                                    <input type="time" value={timesheet[day].end} onChange={(e) => setTimesheet({...timesheet, [day]: {...timesheet[day], end: e.target.value}})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Lunch (hours)</label>
                                    <input type="number" step="0.5" min="0" value={timesheet[day].lunch} onChange={(e) => setTimesheet({...timesheet, [day]: {...timesheet[day], lunch: e.target.value}})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="0.5" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Hours</label>
                                    <div className="w-full px-3 py-2 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-900 font-semibold">
                                        {calculateHours(timesheet[day].start, timesheet[day].end, timesheet[day].lunch).toFixed(2)}h
                                    </div>
                                </div>
                            </div>
                            <div className="mt-3">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Notes (optional)</label>
                                <input type="text" value={timesheet[day].notes} onChange={(e) => setTimesheet({...timesheet, [day]: {...timesheet[day], notes: e.target.value}})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Add any notes for this day..." />
                            </div>
                        </div>
                    ))}

                    <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                        <div className="flex justify-between items-center">
                            <span className="text-lg font-semibold text-indigo-900">Total Hours:</span>
                            <span className="text-2xl font-bold text-indigo-600">{getTotalHours().toFixed(2)}h</span>
                        </div>
                        {getTotalHours() > 37.5 && (
                            <div className="flex justify-between items-center mt-2">
                                <span className="text-lg font-semibold text-green-900">Overtime:</span>
                                <span className="text-2xl font-bold text-green-600">{(getTotalHours() - 37.5).toFixed(2)}h</span>
                            </div>
                        )}
                    </div>

                    <div className="flex items-center">
                        <input type="checkbox" id="foodReimbursement" checked={timesheet.foodReimbursement} onChange={(e) => setTimesheet({...timesheet, foodReimbursement: e.target.checked})} className="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" />
                        <label htmlFor="foodReimbursement" className="ml-3 text-sm font-medium text-gray-700">
                            I had to buy my own food (678 NOK reimbursement)
                        </label>
                    </div>

                    <div className="flex gap-3 mt-6">
                        <button type="button" onClick={onPrev} className="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-medium">
                            <i className="fas fa-arrow-left mr-2"></i>Previous
                        </button>
                        <button type="submit" className="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                            Next: Travel <i className="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </form>
            );
        }

        function TravelPage({ travel, setTravel, onNext, onPrev, onSkip }) {
            const addTrip = () => {
                setTravel([...travel, { date: '', from: '', to: '', km: '' }]);
            };

            const removeTrip = (index) => {
                setTravel(travel.filter((_, i) => i !== index));
            };

            const updateTrip = (index, field, value) => {
                const updated = [...travel];
                updated[index][field] = value;
                setTravel(updated);
            };

            const getTotalReimbursement = () => {
                return travel.reduce((sum, trip) => sum + (parseFloat(trip.km) || 0) * 4.5, 0);
            };

            return (
                <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-indigo-900 mb-4">Travel Expenses</h2>
                    <p className="text-gray-600 mb-4">Reimbursement rate: 4.5 NOK per kilometer</p>

                    {travel.map((trip, index) => (
                        <div key={index} className="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-semibold text-gray-800">Trip {index + 1}</h3>
                                <button type="button" onClick={() => removeTrip(index)} className="text-red-500 hover:text-red-700">
                                    <i className="fas fa-trash"></i>
                                </button>
                            </div>
                            <div className="grid md:grid-cols-4 gap-3">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                    <input type="date" value={trip.date} onChange={(e) => updateTrip(index, 'date', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">From</label>
                                    <input type="text" value={trip.from} onChange={(e) => updateTrip(index, 'from', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Start location" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">To</label>
                                    <input type="text" value={trip.to} onChange={(e) => updateTrip(index, 'to', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="End location" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Kilometers</label>
                                    <input type="number" step="0.1" value={trip.km} onChange={(e) => updateTrip(index, 'km', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="0" />
                                </div>
                            </div>
                            <div className="mt-2 text-right text-indigo-600 font-semibold">
                                Reimbursement: {((parseFloat(trip.km) || 0) * 4.5).toFixed(2)} NOK
                            </div>
                        </div>
                    ))}

                    <button type="button" onClick={addTrip} className="w-full px-4 py-3 border-2 border-dashed border-indigo-300 text-indigo-600 rounded-lg hover:bg-indigo-50 font-medium">
                        <i className="fas fa-plus mr-2"></i>Add Trip
                    </button>

                    {travel.length > 0 && (
                        <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                            <div className="flex justify-between items-center">
                                <span className="text-lg font-semibold text-indigo-900">Total Reimbursement:</span>
                                <span className="text-2xl font-bold text-indigo-600">{getTotalReimbursement().toFixed(2)} NOK</span>
                            </div>
                        </div>
                    )}

                    <div className="flex gap-3 mt-6">
                        <button type="button" onClick={onPrev} className="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-medium">
                            <i className="fas fa-arrow-left mr-2"></i>Previous
                        </button>
                        <button type="button" onClick={onSkip} className="flex-1 px-6 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-medium">
                            Skip
                        </button>
                        <button type="button" onClick={onNext} className="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                            Next: Expenses <i className="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            );
        }

        function ExpensesPage({ expenses, setExpenses, onNext, onPrev, onSkip }) {
            const addExpense = () => {
                setExpenses([...expenses, { date: '', type: 'Taxi', description: '', amount: '', receipts: [] }]);
            };

            const removeExpense = (index) => {
                setExpenses(expenses.filter((_, i) => i !== index));
            };

            const updateExpense = (index, field, value) => {
                const updated = [...expenses];
                updated[index][field] = value;
                setExpenses(updated);
            };

            const handleFileUpload = (index, files) => {
                const updated = [...expenses];
                const newReceipts = Array.from(files).map(file => ({
                    name: file.name,
                    url: URL.createObjectURL(file),
                    rotation: 0
                }));
                updated[index].receipts = [...(updated[index].receipts || []), ...newReceipts];
                setExpenses(updated);
            };

            const rotateImage = (expIndex, receiptIndex) => {
                const updated = [...expenses];
                updated[expIndex].receipts[receiptIndex].rotation = (updated[expIndex].receipts[receiptIndex].rotation + 90) % 360;
                setExpenses(updated);
            };

            const removeReceipt = (expIndex, receiptIndex) => {
                const updated = [...expenses];
                updated[expIndex].receipts.splice(receiptIndex, 1);
                setExpenses(updated);
            };

            const capturePhoto = (index) => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.capture = 'environment';
                input.onchange = (e) => handleFileUpload(index, e.target.files);
                input.click();
            };

            const getTotalExpenses = () => {
                return expenses.reduce((sum, exp) => sum + (parseFloat(exp.amount) || 0), 0);
            };

            return (
                <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-indigo-900 mb-4">Other Expenses</h2>

                    {expenses.map((expense, index) => (
                        <div key={index} className="border border-gray-200 rounded-lg p-4 bg-gray-50">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-semibold text-gray-800">Expense {index + 1}</h3>
                                <button type="button" onClick={() => removeExpense(index)} className="text-red-500 hover:text-red-700">
                                    <i className="fas fa-trash"></i>
                                </button>
                            </div>
                            <div className="grid md:grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                    <input type="date" value={expense.date} onChange={(e) => updateExpense(index, 'date', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                    <select value={expense.type} onChange={(e) => updateExpense(index, 'type', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="Taxi">Taxi</option>
                                        <option value="Bus">Bus</option>
                                        <option value="Train">Train</option>
                                        <option value="Purchase">Purchase</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div className="mb-3">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <input type="text" value={expense.description} onChange={(e) => updateExpense(index, 'description', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Describe the expense" />
                            </div>
                            <div className="mb-3">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Amount (NOK)</label>
                                <input type="number" step="0.01" value={expense.amount} onChange={(e) => updateExpense(index, 'amount', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="0.00" />
                            </div>
                            
                            <div className="mb-3">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Receipts</label>
                                <div className="flex gap-2 mb-3">
                                    <label className="flex-1 px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 cursor-pointer text-center">
                                        <i className="fas fa-upload mr-2"></i>Upload
                                        <input type="file" accept="image/*" multiple onChange={(e) => handleFileUpload(index, e.target.files)} className="hidden" />
                                    </label>
                                    <button type="button" onClick={() => capturePhoto(index)} className="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                        <i className="fas fa-camera mr-2"></i>Camera
                                    </button>
                                </div>
                                
                                {expense.receipts && expense.receipts.length > 0 && (
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        {expense.receipts.map((receipt, rIndex) => (
                                            <div key={rIndex} className="relative border border-gray-300 rounded-lg p-2 bg-white">
                                                <img src={receipt.url} alt={receipt.name} style={{transform: `rotate(${receipt.rotation}deg)`}} className="w-full h-32 object-cover rounded mb-2" />
                                                <div className="flex gap-1">
                                                    <button type="button" onClick={() => rotateImage(index, rIndex)} className="flex-1 px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                                                        <i className="fas fa-redo"></i>
                                                    </button>
                                                    <button type="button" onClick={() => removeReceipt(index, rIndex)} className="flex-1 px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    ))}

                    <button type="button" onClick={addExpense} className="w-full px-4 py-3 border-2 border-dashed border-indigo-300 text-indigo-600 rounded-lg hover:bg-indigo-50 font-medium">
                        <i className="fas fa-plus mr-2"></i>Add Expense
                    </button>

                    {expenses.length > 0 && (
                        <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                            <div className="flex justify-between items-center">
                                <span className="text-lg font-semibold text-indigo-900">Total Expenses:</span>
                                <span className="text-2xl font-bold text-indigo-600">{getTotalExpenses().toFixed(2)} NOK</span>
                            </div>
                        </div>
                    )}

                    <div className="flex gap-3 mt-6">
                        <button type="button" onClick={onPrev} className="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-medium">
                            <i className="fas fa-arrow-left mr-2"></i>Previous
                        </button>
                        <button type="button" onClick={onSkip} className="flex-1 px-6 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-medium">
                            Skip
                        </button>
                        <button type="button" onClick={onNext} className="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                            Next: Signature <i className="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            );
        }

        function SignaturePage({ signature, setSignature, onPrev, onSubmit, onEmail, employeeInfo, totalHours, overtime, travelReimbursement, expensesTotal, foodReimbursement }) {
            const handleSubmit = (e) => {
                e.preventDefault();
                if (!signature) {
                    alert('Please enter your signature');
                    return;
                }
                onSubmit();
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-6">
                    <h2 className="text-2xl font-bold text-indigo-900 mb-4">Review & Submit</h2>

                    <div className="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <h3 className="text-xl font-semibold text-gray-800 mb-4">Summary</h3>
                        <div className="space-y-2">
                            <div className="flex justify-between">
                                <span className="text-gray-700">Employee:</span>
                                <span className="font-semibold">{employeeInfo.firstName} {employeeInfo.lastName}</span>
                            </div>
                            <div className="flex justify-between">
                                <span className="text-gray-700">Total Hours:</span>
                                <span className="font-semibold">{totalHours.toFixed(2)}h</span>
                            </div>
                            {overtime > 0 && (
                                <div className="flex justify-between">
                                    <span className="text-gray-700">Overtime:</span>
                                    <span className="font-semibold text-green-600">{overtime.toFixed(2)}h</span>
                                </div>
                            )}
                            {foodReimbursement && (
                                <div className="flex justify-between">
                                    <span className="text-gray-700">Food Reimbursement:</span>
                                    <span className="font-semibold">678 NOK</span>
                                </div>
                            )}
                            {travelReimbursement > 0 && (
                                <div className="flex justify-between">
                                    <span className="text-gray-700">Travel Reimbursement:</span>
                                    <span className="font-semibold">{travelReimbursement.toFixed(2)} NOK</span>
                                </div>
                            )}
                            {expensesTotal > 0 && (
                                <div className="flex justify-between">
                                    <span className="text-gray-700">Other Expenses:</span>
                                    <span className="font-semibold">{expensesTotal.toFixed(2)} NOK</span>
                                </div>
                            )}
                            <div className="border-t border-gray-300 pt-2 mt-2">
                                <div className="flex justify-between text-lg">
                                    <span className="text-gray-900 font-bold">Total Reimbursement:</span>
                                    <span className="font-bold text-indigo-600">
                                        {(travelReimbursement + expensesTotal + (foodReimbursement ? 678 : 0)).toFixed(2)} NOK
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Digital Signature *</label>
                        <input type="text" required value={signature} onChange={(e) => setSignature(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-signature text-2xl" placeholder="Type your full name" style={{fontFamily: 'cursive'}} />
                        <p className="text-xs text-gray-500 mt-1">By typing your name, you certify that the information provided is accurate.</p>
                    </div>

                    <div className="flex gap-3">
                        <button type="button" onClick={onPrev} className="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-medium">
                            <i className="fas fa-arrow-left mr-2"></i>Previous
                        </button>
                        <button type="button" onClick={onEmail} className="flex-1 px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium">
                            <i className="fas fa-envelope mr-2"></i>Email
                        </button>
                        <button type="submit" className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
                            <i className="fas fa-download mr-2"></i>Download PDF
                        </button>
                    </div>
                </form>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
